package DGU;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.util.ArrayList;

class Fruits {
    private String name;
    private int price;
    private ImageIcon image;

    Fruits(String n, int p) {
        name = n;
        price = p;
        image = new ImageIcon("c:\\Q202\\images\\" + name + ".png");
    }

    String getFName() {
        return name;
    }

    int getFPrice() {
        return price;
    }

    ImageIcon getImage() {
        return image;
    }
}

public class Grade_2019111679_022_2 extends JFrame {
    private int w, h;
    private Container c = getContentPane();
    private ArrayList<Fruits> fruitsList = new ArrayList<>();

    public Grade_2019111679_022_2() {
        w = 300;
        h = 300;
        setTitle("확장");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        c.add(new Panel1(this), BorderLayout.CENTER);
        setSize(w, h);
        setVisible(true);
    }

    public void changePanel(JPanel panel) {
        c.removeAll();
        c.add(panel, BorderLayout.CENTER);
        c.revalidate();
        c.repaint();
    }

    public ArrayList<Fruits> getFruitsList() {
        return fruitsList;
    }

    public static void main(String[] args) {
        new Grade_2019111679_022_2();
    }
}

class Panel1 extends JPanel {
    Panel1(final Grade_2019111679_022_2 frame) {
        setLayout(new GridLayout(3, 1));
        add(new JLabel("과일의 개수를 입력하세요"));

        final JTextField numberField = new JTextField();
        add(numberField);

        JButton confirmButton = new JButton("확인");
        confirmButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                int size = Integer.parseInt(numberField.getText());
                frame.changePanel(new Panel2(frame, size));
            }
        });
        add(confirmButton);
    }
}

class Panel2 extends JPanel {
    private ArrayList<JTextField> nameFields = new ArrayList<>();
    private ArrayList<JTextField> priceFields = new ArrayList<>();
    private ArrayList<JLabel> nameLabels = new ArrayList<>(); // 과일 이름 레이블 리스트 추가
    private ArrayList<JLabel> priceLabels = new ArrayList<>(); // 과일 가격 레이블 리스트 추가
    private JPanel fieldsPanel;

    Panel2(final Grade_2019111679_022_2 frame, int initialSize) {
        setLayout(new BorderLayout());

        fieldsPanel = new JPanel();
        fieldsPanel.setLayout(new GridLayout(0, 2));
        JScrollPane scrollPane = new JScrollPane(fieldsPanel);

        for (int i = 0; i < initialSize; i++) {
            addFruitField();
        }

        JButton addButton = new JButton("과일 추가");
        addButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                addFruitField();
            }
        });

        JButton removeButton = new JButton("과일 제거");
        removeButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                removeFruitField();
            }
        });

        JButton confirmButton = new JButton("확인");
        confirmButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                frame.getFruitsList().clear();
                for (int i = 0; i < nameFields.size(); i++) {
                    String name = nameFields.get(i).getText();
                    int price;
                    try {
                        price = Integer.parseInt(priceFields.get(i).getText());
                    } catch (NumberFormatException nfe) {
                        price = 0; // or handle error
                    }
                    frame.getFruitsList().add(new Fruits(name, price));
                }
                frame.changePanel(new Panel3(frame.getFruitsList()));
            }
        });

        JPanel buttonPanel = new JPanel();
        buttonPanel.add(addButton);
        buttonPanel.add(removeButton);
        buttonPanel.add(confirmButton);

        add(scrollPane, BorderLayout.CENTER);
        add(buttonPanel, BorderLayout.SOUTH);
    }

    private void addFruitField() {
        JTextField nameField = new JTextField();
        JTextField priceField = new JTextField();
        nameFields.add(nameField);
        priceFields.add(priceField);

        JLabel nameLabel = new JLabel("과일 이름:"); // 과일 이름 레이블 생성
        JLabel priceLabel = new JLabel("과일 가격:"); // 과일 가격 레이블 생성
        nameLabels.add(nameLabel); // 리스트에 추가
        priceLabels.add(priceLabel); // 리스트에 추가

        fieldsPanel.add(nameLabel);
        fieldsPanel.add(nameField);
        fieldsPanel.add(priceLabel);
        fieldsPanel.add(priceField);
        fieldsPanel.revalidate();
        fieldsPanel.repaint();
    }

    private void removeFruitField() {
        int index = nameFields.size() - 1;
        if (index >= 0) {
            fieldsPanel.remove(nameLabels.remove(index)); // 과일 이름 레이블 제거
            fieldsPanel.remove(nameFields.remove(index)); // 과일 이름 텍스트필드 제거
            fieldsPanel.remove(priceLabels.remove(index)); // 과일 가격 레이블 제거
            fieldsPanel.remove(priceFields.remove(index)); // 과일 가격 텍스트필드 제거
            fieldsPanel.revalidate();
            fieldsPanel.repaint();
        }
    }
}

class Panel3 extends JPanel {
    private JLabel showImage;
    private JLabel showPrice;

    Panel3(ArrayList<Fruits> fruits) {
        setLayout(new BorderLayout());
        JPanel radioPanel = new JPanel(new GridLayout(1, 0)); // 1행으로 모든 라디오 버튼을 가로로 나열
        ButtonGroup group = new ButtonGroup();
        showImage = new JLabel("", SwingConstants.CENTER);
        showPrice = new JLabel("과일을 선택하세요.", SwingConstants.CENTER);
        transformImageSize trans = new transformImageSize(); // 인스턴스 생성

        for (int i = 0; i < fruits.size(); i++) {
            Fruits fruit = fruits.get(i);
            JRadioButton button = new JRadioButton(fruit.getFName());
            button.addActionListener(new ActionListener() {
                public void actionPerformed(ActionEvent e) {
                    ImageIcon icon = fruit.getImage();
                    if (icon.getIconWidth() == -1) {
                        // 이미지를 찾지 못했을 경우의 처리
                        showImage.setIcon(null);
                        showPrice.setText("이미지를 찾지 못했습니다.");
                    } else {
                        // 이미지 크기 변환
                        icon = trans.transformImageSize(icon, 200, 200);
                        showImage.setIcon(icon);
                        showPrice.setText(fruit.getFName() + "의 가격은 " + fruit.getFPrice() + "원 입니다.");
                    }
                }
            });
            group.add(button);
            radioPanel.add(button);
        }

        JScrollPane radioScrollPane = new JScrollPane(radioPanel);
        radioScrollPane.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
        radioScrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_NEVER);

        add(radioScrollPane, BorderLayout.NORTH);
        add(showImage, BorderLayout.CENTER);
        add(showPrice, BorderLayout.SOUTH);
    }
}